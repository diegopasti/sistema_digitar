{% extends 'base_page.html' %}
{% block Titulo %}<title>Digitar - Controle de Honorários</title>{% endblock %}
{% load staticfiles %}
{% block recursos_necessarios %}
<style>
	table td{
		height: 26px;
		padding: 0px !important;
		padding-top: 7px !important;
		padding-left: 4px !important;
		padding-right: 4px !important;
	}

	table th{
		font-size: 12px;
		font-weight: bold;
		background: #FFF; /*#9FB8FB; #EEEEEF; #85A3CC #EEE #8FB5EC; *#6FB2BE; #009ACD;*/
		color: #666;
	}

	.container {
		padding-left: 0px;
		padding-right: 0px;
		padding-bottom: 0px;
		margin-bottom: 0px;
    width: 100%;
    overflow-x: auto;
    white-space: nowrap;
	}
</style>
{% endblock %}
{% block conteudo %}
<div id="controle_angular" ng-app="app" ng-controller="MeuController" ng-init="registros_carregados=false;">
	<div class="row" style="margin-top: -55px;">
		<div class="col-lg-12 col-md-12 col-xs-12">
			<div class="box box-default" >
				<div class="box-heading">
					<div class="box-header with-border">
						<h5 class="box-title">Controle de Honorários</h5>
						<div class="pull-right">
							<div class="btn-group" role="group" aria-label="...">
								<button id='bt_insert_provent' role="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#modal_provents" ng-disabled="registro_selecionado==null" ng-click="get_honorary_item()">Proventos e Descontos</button>
								<button id='bt_honorary' role="button" class="btn btn-sm btn-default" ng-disabled="registro_selecionado==null" style="margin-left: 5px;">Gerar Honorário</button>

								<div class="btn-group" role="group" style='margin-left: 5px;'>
									<button type="button" id='bt_outras_acoes' class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
									<ul class="dropdown-menu dropdown-menu-right">
										<li><a id="close_competence" ng-click="close_current_competences()" style="cursor: pointer;">Encerrar Competência</a></li>
										<li><a ng-click="load_competences()" style="cursor: pointer;">Atualizar Contratos</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="box-body" style="margin-bottom: -10px;margin-top: 0px;">
					<div class="dataTable_wrapper">
						<div class='row'>
							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
								{% verbatim %}
								<div class="container">
									<table class="table table-condensed  table-striped table-bordered table-hover" id="table_contratos" style="width: 100%;">
										<thead>
											<tr class="linha_cabecalho no-select">
												<th class='text-center' style="width: 40px;" ng-click="sortType='id';sortReverse=!sortReverse">N°</th>
												<th class='text-center' style="width:60px;" ng-click="sortType='competence';sortReverse=!sortReverse">Comp.</th>
												<th class='text-center' ng-click="sortType='cliente';sortReverse=!sortReverse">Cliente</th>
												<th class='text-center' style="width: 100px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Valor Contrato</th>
												<th class='text-center' style="width: 100px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Desc. Contrato</th>
												<th class='text-center' style="width: 90px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Proventos</th>
												<th class='text-center' style="width: 90px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Descontos</th>
												<th class='text-center' style="width: 90px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Ressarcimento</th>
												<th class='text-center' style="width: 90px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Ult. Alteração</th>
												<th class="text-center" style="width: 120px;">Alterado por</th>
												<th class='text-center' style="width: 100px;" ng-click="sortType='plano';sortReverse=!sortReverse" >Situação</th>
												<th class='text-center' style="width: 90px;" ng-click="sortType='last_update';sortReverse=!sortReverse">Honorário</th>
											</tr>
										</thead>

										<tbody style="font-size: 11px;">

											<tr id="divCarregando" ng-if="registros_carregados == false"><!-- style='height:{{ table_maximun_body_heigth }}px;'>-->
												<td colspan="12" style='background: #FFFAFA;opacity: 0.5;vertical-align: middle' class="text-center"><br><i class="fa fa-refresh fa-spin fa-3x fa-fw"></i><br><br>Aguarde.. Carregando...<br><br></td>
											</tr>

											<tr ng-cloak ng-if='registros_carregados' class="angular-repeat linha_selecionavel {{ registro.selecionado }}" dir-paginate="registro in resultado = (registros | filter: get_filter_column()) | itemsPerPage:table_maximun_items_per_page | orderBy:sortType:sortReverse" ng-click="selecionar_linha(registro);" pagination-id="paginate_registros">
												<td class='text-center' style="width: 30px;">{{ registro.id }}</td>
												<td class="text-center" style="width: 60px;">{{ registro.competence }}</td>
												<td class='text-left'>{{ registro.entity_name }}</td>
												<td class='text-right' style="width: 90px;">{{ registro.initial_value_contract| currency:"" }}</td>
												<td class='text-center' style="width: 100px;" title="Desconto Fidelidade {{ registro.fidelity_discount| currency:'' }}% e Desconto Temporário {{ registro.temporary_discount| currency:'' }}%">{{ registro.contract_discount| currency:"" }} %</td>
												<td class='text-right' style="width: 90px;">{{ registro.total_debit| currency:"" }}</td>
												<td class='text-right' style="width: 90px;">{{ registro.total_credit| currency:"" }}</td>
												<td class='text-right' style="width: 90px;">{{ registro.total_repayment| currency:"" }}</td>

												<td class='text-center' style="width: 90px;" title="Atualizado {{ registro.last_update| date: 'dd/MM/yyyy' }} às {{ registro.last_update| date: 'HH:mm:ss' }}">{{ registro.last_update| date: 'dd/MM/yyyy' }}</td>
												<td class="text-left" style="width: 100px;">{{ registro.updated_by_name }}</td>
												<td class='text-center' style="width: 100px;">
													<span ng-show="registro.is_closed==false">EM CONFECÇÃO</span>
													<span ng-show="registro.is_closed==true">ENCERRADO</span>
												</td>
												<td class='text-right' style="width: 90px;">{{ registro.total_honorary| currency:"" }}</td>
											</tr>

											<tr ng-cloak ng-if='registros_carregados' ng-repeat="k in table_minimun_items.slice(registros.length,table_minimun_items.length)">
												<td style="width:30px;"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
											</tr>

											<tr ng-if="resultado.length">
												<td colspan="12" class='text-center'>Nenhum resultado Encontrado</td>
											</tr>
										</tbody>
									</table>
								</div>
								{% endverbatim %}
							</div>
						</div>
					</div>

					<div class='row no-gutter' style="padding: 0px 10px 0px 10px;">
						{% verbatim %}
						<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12" style='margin-top:6px;'>
							<label id="label_competence" class='left {{ desabilitar }}'><sub>Mês de competência:</sub></label>
							<select id='competence' class='form-control {{ desabilitar }}' onchange="select_competence()">
							</select>
						</div>

						<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12" style='margin-top:6px;'>
							<label id="label_buscar_por" class='left {{ desabilitar }}'><sub>Buscar por:</sub></label>
							<select id='buscar_por' class='form-control {{ desabilitar }}' ng-model="filter_by" ng-change="select_filter_by()">
								<option value="0">CÓDIGO</option>
								<option value="1" selected>CLIENTE</option>
								<option value="2">COMPETÊNCIA</option>
							</select>
						</div>

						<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12" style='margin-top: 31px;'>
							<input type="text" id="search" ng-model='search' class="form-control {{ desabilitar }}" placeholder="Consultar..">
						</div>

						<div class="col-lg-4 col-md-6 col-sm-4 col-xs-12 mt-xs-0 pull-right" ng-if="registros_carregados == true" >
							<span class="pull-right" style="height: 64px;padding-top: 10px;"><!-- style="margin-top:-54px;margin-bottom: -30px;margin-right: 0px;">-->
								<dir-pagination-controls pagination-id="paginate_registros" max-size="5" auto-hide="false" boundary-links="true" direction-links="true">
								</dir-pagination-controls>
							</span>
						</div>
						{% endverbatim %}
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="modal_provents" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
		<div class="modal-dialog" style="width: 90%;margin-left: auto; margin-right: auto;">
			<form id="form_honorary_item" novalidate autocomplete="off" ng-submit="save_honorary_item()" onsubmit="return false;">
				{% csrf_token %}
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h5 id="titulo_modal_provents" class='modal_title' style="font-weight: bold">Proventos e Descontos</h5>
					</div>

					<div class="modal-body" style="padding: 30px;padding-top: 15px;padding-bottom: 5px;">
						<div class="row no-gutter fluid">
							<div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
								<div class="form-group field" id="field_type_item">
									<sub><label id="lb_type_item" for="type_item">{{ formulario_proventos.type_item.label }}</label></sub>
									{{ formulario_proventos.type_item }}
								</div>
							</div>

							<div class="col-lg-5 col-md-3 col-sm-12 col-xs-12">
								<div class="form-group field" id="field_item">
									<sub><label id="lb_item" for="item">{{ formulario_proventos.item_id.label }}*</label></sub>
									{% verbatim %}
									<select id="item_id" class="form-control">
										<option ng-repeat="option in provents_options" value="{{option.id}}" ng-show="view_provents_per_type(option)" ng-click="select_provent_option(option)">
											{{ option.nome }}
										</option>
									</select>
									{% endverbatim %}
								</div>
							</div>

							<div class="col-lg-1 col-md-3 col-sm-12 col-xs-12">
								<div class="form-group field" id="field_unit_value">
									<sub><label id="lb_unit_value" for="unit_value">{{ formulario_proventos.unit_value.label }}*</label> </sub>
									{{ formulario_proventos.unit_value}}
								</div>
							</div>

							<div class="col-lg-1 col-md-1 col-sm-1 col-xs-12">
								<div class="form-group field" id="field_quantity">
									<sub><label id="lb_quantity" for="quantity">{{ formulario_proventos.quantity.label }}</label> </sub>
									{{ formulario_proventos.quantity }}
								</div>
							</div>

							<div class="col-lg-1 col-md-1 col-sm-1 col-xs-12">
								<div class="form-group field" id="field_total_value">
									<sub><label id="lb_total_value" for="total_value">{{ formulario_proventos.total_value.label }}</label></sub>
									{{ formulario_proventos.total_value }}
								</div>
							</div>

							<div class="col-md-push-1 col-lg-1 col-md-1 col-sm-1 col-xs-12">
								<div class="form-group field" id="field_save">
									<sub><label id="lb_save" for="save"></label></sub>
									<button type="submit" id="bt_submit_contrato" class="btn btn-sm btn-primary form-control" data-toggle="modal" data-target="">Salvar</button>
								</div>
							</div>
						</div>

						<div class="row no-gutter fluid">
							<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
								{% verbatim %}
								<div class="dataTable_wrapper" style="margin-left: 0px;margin-right:0px;margin-bottom:0px;padding-bottom: 0px;">
									<div class='row' style="padding-bottom: 0px;margin-bottom:0px;">
										<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
											<table class="table table-condensed  table-striped table-bordered table-hover" id="datatable">
												<thead>
													<tr class="linha_cabecalho">

														<th class='center'>Tipo</th>

														<th class="center">Item</th>

														<th class="center">Data de Criação</th>

														<th class="center">Cadastrado por</th>

														<th class="center">Ultima alteração</th>

														<th class="center">Alterado por</th>

														<th class="center">Unit/Base</th>

														<th class='center'>Quant/Taxa</th>

														<th class='center'>Valor Total</th>


													</tr>
												</thead>

												<style>
													#datatable td{
														padding: 0px;
														padding-top: 4px;
														height: 26px;
													}
												</style>

												<tbody>
													<tr ng-if="registro_selecionado.honorary_itens == '' && typeof(registro_selecionado.honorary_itens)=='string'">
														<td colspan="9" style='height: 260px; background: #FFFAFA; opacity: 0.5;vertical-align: middle;' class="text-center">
															Aguarde.. Carregando...<br><i class="fa fa-refresh fa-spin fa-3x fa-fw"></i>
														</td>
													</tr>

													<tr ng-if="registro_selecionado.honorary_itens.length > 0" class="angular-repeat linha_selecionavel {{ registro.selected }}" ng-repeat='registro in registro_selecionado.honorary_itens' ng-click="selecionar_linha_indicacao(registro)" style="font-size: 10px;">
														<td class="left" style="padding-left: 6px; width: 70px;">
															<span ng-if="registro.type_item=='P'">PROVENTO</span>
															<span ng-if="registro.type_item=='D'">DESCONTO</span>
															<span ng-if="registro.type_item=='R'">PROVENTO</span>
														</td>
														<td class="left"	style="padding-left: 6px;">{{ registro.item__nome }}</td>

														<td class="center"	style="padding-left: 6px; width: 125px;">{{ registro.created_date | date:'dd/MM/yyyy' }} às {{ registro.created_date | date:'HH:mm:ss' }}</td>
														<td class="left"	style="padding-left: 6px;">{{ registro.created_by__get_full_name }}</td>
														<td class="center"	style="padding-left: 6px;width: 125px;">{{ registro.last_update | date:'dd/MM/yyyy' }} às {{ registro.last_update | date:'HH:mm:ss' }}</td>
														<td class="left"	style="padding-left: 6px;">{{ registro.updated_by__get_full_name }}</td>

														<td class="right"	style="padding-left: 6px; width: 90px;">
															<span ng-if="registro.unit_value != '' && registro.unit_value != null">{{ registro.unit_value | currency:"" }}</span>
														</td>
														<td class="right"	style="padding-left: 6px; width: 90px;">
															<span ng-if="registro.type_value=='R'">{{ registro.quantity | currency:""}}</span>
															<span ng-if="registro.unit_value != '' && registro.unit_value != null && registro.type_value=='P'">{{ registro.quantity | currency:""}} %</span>
														</td>
														<td class="right"	style="padding-left: 6px; width: 90px;">
															<span ng-if="registro.type_item=='P' || registro.type_item=='R' ">{{ registro.total_value| currency:"" }}</span>
															<span ng-if="registro.type_item=='D'" style="color: #800000">- {{ registro.total_value| currency:"" }}</span>
														</td>


													</tr>

													<tr ng-repeat="k in minimal_quantity_rows.slice(registro_selecionado.honorary_itens.length,minimal_quantity_rows.length)">
													<td style="width:70px;"></td>
													<td></td>
													<td style="width:90px;"></td>
														<td style="width:90px;"></td>
													<td style="width:90px;"></td>
													<td style="width:90px;"></td>
													<td style="width:90px;"></td>
													<td style="width:90px;"></td>
													<td style="width:90px;"></td>
												</tr>

												</tbody>
											</table>
										</div>
									</div>

									<style>
										.custom-box-default{
											padding-top: 2px;
											padding-bottom: 2px;
											padding-left: 12px;
											padding-right: 12px;
											border-radius: 3px;
											border-top: 0px solid #ddd;
											border-left: 0px solid #ddd;
											border-right: 0px solid #ddd;
											color: #888;
											border-bottom: 2px solid #ddd;
										}

										.custom-box-primary{
											padding-top: 2px;
											padding-bottom: 2px;
											padding-left: 12px;
											padding-right: 12px;
											border-radius: 3px;
											border-top: 0px solid #ddd;
											border-left: 0px solid #ddd;
											border-right: 0px solid #ddd;
											color: #888;
											border-bottom: 2px solid #3C8dbc !important;
										}

										.custom-box-danger{
											padding-top: 2px;
											padding-bottom: 2px;
											padding-left: 12px;
											padding-right: 12px;
											border-radius: 3px;
											border-top: 0px solid #ddd;
											border-left: 0px solid #ddd;
											border-right: 0px solid #ddd;
											color: #888;
											border-bottom: 2px solid #800000 !important;
										}
									</style>

									<div class='row status' style="padding-left: 20px;padding-right: 20px;">
										<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
											<div class="custom-box-default">
												<h6>Total de Proventos: <span class="pull-right">{{ registro_selecionado.total_debit | currency:"R$ "}}</span></h6>
											</div>
										</div>

										<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
											<div class="custom-box-default">
												<h6>Total de Descontos: <span class="pull-right">{{ registro_selecionado.total_credit | currency:"R$ "}}</span></h6>
											</div>
										</div>

										<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
											<div class="custom-box-default">
												<h6>Total de Ressarcimento: <span class="pull-right">{{ registro_selecionado.total_repayment | currency:"R$ "}}</span></h6>
											</div>
										</div>

										<div class="col-lg-3 col-md-3 col-sm-3 col-xs-3">
											<div ng-if='registro_selecionado.total_debit_credit==0' class="custom-box-defaul">
												<h6 style="font-weight: bold;color: #555;">Total: <span class="pull-right">{{ registro_selecionado.total_debit_credit | currency:"R$ "}}</span></h6>
											</div>
											<div ng-if='registro_selecionado.total_debit_credit>0' class="custom-box-primary">
												<h6 style="font-weight: bold; color:#3C8dbc;">Total: <span class="pull-right">{{ registro_selecionado.total_debit_credit | currency:"R$ "}}</span></h6>
											</div>
											<div ng-if='registro_selecionado.total_debit_credit < 0' class="custom-box-danger">
												<h6 style="font-weight: bold;color: #800000;">Total: <span class="pull-right">{{ registro_selecionado.total_debit_credit | currency:"R$ "}}</span></h6>
											</div>
										</div>
									</div>
									<br>
								</div>
								{% endverbatim %}
							</div>
						</div>
					</div>

					<div class="modal-footer">

					</div>
				</div>
			</form>
		</div>
	</div>

	<div id="modal_justify_action" class="modal fade"  tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
		<div class="modal-dialog" style="width: 60%">
			<div class="modal-content">
				<form id="form_justify_action" autocomplete="off" ng-submit="disable();">
					<div class="modal-header" style="padding-top:2px;"><!-- style="height: 48px;"> -->
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-top:10px;">×</button>
						<h4 id="myModalLabel">Desativar Provento</h4>
					</div>

					<div class="modal-body">
						<style>
							.only_bottom_border{
								background-color: #fff !important;
								border-bottom: 1px solid #ccc !important;
								box-shadow:none !important;
								cursor: default;
							}
						</style>
						<div style="margin-top: 0px;">
							<div class="row">
								<div class="col-lg-12">
									<p id="action_info" style="padding: 10px; padding-bottom: 4px;">
										Por questões de segurança e integridade das informações esse registro não pode ser excluido definitivamente, apenas
										desativado para que não esteja disponiveis em operações futuras. Justificativa obrigatória para prosseguir.
									</p>
								</div>
							</div>

							<div class="row">
								<div class="col-lg-4 col-md-2">
									<sub style='padding-left: 2px'><label>Operação:</label></sub>
									<input id="action_type" type="text" class="form-control uppercase only_bottom_border" readonly onfocus="this.blur();" />
								</div>


								<div class="col-lg-4 col-md-3">
									<sub style='padding-left: 2px'><label>Usuário:</label></sub>
									<input id="action_user" type="text" class="form-control uppercase only_bottom_border" readonly onfocus="this.blur();" />
								</div>


								<div class="col-lg-4 col-md-7">
									<sub style='padding-left: 2px'><label>Registro:</label></sub>
									<input id="action_object" type="text" class="form-control uppercase only_bottom_border" readonly onfocus="this.blur();">
								</div>
							</div>

							<div class="row">
								<div class="col-lg-12">
									<div class="form-group field" id="field_action_justify">
										<sub>
											<label>Justificativa:</label>
										</sub>
										<textarea id="action_justify" rows="5" class="form-control uppercase"></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="modal-footer">
						<div class="form-group">
							<button type='submit' id="bt_confirmar_desativacao" class="btn btn-danger pull-right">Desativar</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>


</div>
{% endblock %}
{% block recursos_complementares %}
{% load staticfiles %}
{% load compress %}
{% compress js %}
<script src="{% static 'modules/core/controle_componentes.js' %}"/>
<script src="{% static 'modules/honorary/honorary/js/honoraryController.js' %}"/>
<script src="{% static 'modules/honorary/honorary/js/honorary.js' %}"/>
{% endcompress %}
{% endblock %}