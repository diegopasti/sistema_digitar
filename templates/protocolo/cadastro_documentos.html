{% extends 'base_page.html' %}
{% block Titulo %}<meta charset="utf-8"><title>Digitar - Cadastro de Documentos</title>{% endblock %}
{% load staticfiles %}
{% block recursos_necessarios %}
{% load compress %}
{% compress css %}
<link rel="stylesheet" type="text/css" href="{% static 'custom/datatable/DataTables-1.10.11/css/dataTables.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'custom/datatable/plugins/responsivo/Responsive-2.0.2/css/responsive.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'custom/datatable/plugins/select/Select-1.1.2/css/select.bootstrap.min.css' %}"/>
{% endcompress %}

<style type="text/css">
.uppercase{ 
    text-transform: uppercase;
}

.lowercase{ 
    text-transform: uppercase;
}

.center_align{ 
    text-align: center;
}

.left_align{ 
	padding-left: 8px;
    text-align: left;
}

.right_align{ 
    text-align: right;
}

.link_desabilitado {
     pointer-events: none;
     cursor: default;
     opacity: 0.6;
}

.div_desabilitado {
	display: none;
    z-index: 1000;
    background-color: lightgrey;
    opacity: 0.6;
    pointer-events: none;
}

.dataTables_paginate {
	position: relative;
    display: block;
    top: 30px;
}

label {
    font-weight: normal !important;
}


</style>
{% endblock %}

{% block conteudo %}
<div id="controle_angular" ng-cloak ng-controller="protocolController">
	<div class="row">
		<div class="col-lg-12 col-md-12 col-xs-12">
			<div class="box box-default" style="margin-top: -45px;">
 					<div class="box-heading">
						<div class="box-header with-border">
							<h5 class="box-title">Documentos</h5>
							<div class="pull-right">
								<button id='bt_adicionar' role="button" class="btn btn-sm btn-primary" data-toggle="modal"
									 data-target="#myModal"><i class="fa fa-plus fa-1x" aria-hidden="true"></i> Novo Documento</button>
								<button id='bt_alterar' role="button" class="btn btn-sm btn-default link_desabilitado"
									 data-toggle="modal" data-target="#myModal" ng-disabled="registro_selecionado==null" style='margin-left: 10px;'><i class="fa fa-file-text-o"></i> Alterar</button>
								<button role="button" class="btn btn-sm btn-default pull-right link_desabilitado" id="bt_excluir" ng-disabled="registro_selecionado==null" style="position: relative; margin-top: 0px;margin-right: 2px;margin-left: 10px;">
									<i class="fa fa-trash-o"aria-hidden="true"></i> Excluir</button>
							</div>
						</div>
					</div>

					<div class="box-body" style="padding-bottom: -10px; margin-top: -5px;">
						<div class="dataTable_wrapper">
							<div class='row'>
								<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
									<table class="table table-condensed  table-striped table-bordered table-hover" id="datatable">
										<thead>
										<tr class="linha_cabecalho">
											<th style="vertical-align: middle;"></th>
											<th style="text-align: center;vertical-align: middle;">Nome</th>
											<th style="text-align: center;vertical-align: middle;">Descricão</th>
										</tr>
										</thead>
										<tbody>
										{% for item in dados %}
											<tr><!--  class="alinhado_meio clickable-row " data-href='/consultar_entidade/{{itemid}}> -->
												<td style="text-align: center;cursor:pointer">{{ item.id }}</td>
												<td style="text-align: left;cursor:pointer">{{ item.nome }}</td>
												{% if item.descricao != None %}
												<td style="text-align: left;cursor: pointer">{{ item.descricao }}</td>
												{% else %}
												<td style="text-align: left;cursor: pointer"></td>
												{% endif %}
											</tr>

										{% empty %}
											<tr><td style="text-align: center;" colspan="7">Nenhum Documento Cadastrado!</td></tr>
										{% endfor %}
										</tbody>
							</table>
						</div>
					</div>
				</div>



				<div class='row'>

                    {% if dados %}
					<div class="col-lg-2 col-md-2 col-sm-2 col-xs-6" style='margin-top:-36px;'>
                    {% else %}
                    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-6" style='margin-top:6px;'>
                    {% endif %}

						<label id="label_buscar_por" class='left_align link_desabilitado'><sub>Buscar por:</sub></label>
						 <select id='buscar_por' class='form-control link_desabilitado '>
							 <option value="0">Código</option>
							 <option value="1" selected>Documento</option>
						 	<option value="2">Descrição</option>
						</select>
					</div>

					{% if dados %}
					<div class="col-lg-4 col-md-4 col-sm-5 col-xs-6" style='margin-left:-20px;margin-top: -11px;'>
						{% else %}
						<div class="col-lg-4 col-md-4 col-sm-5 col-xs-6" style='margin-left:-20px;margin-top: 31px;'>
						{% endif %}
						<input type="text" id="search" class="form-control link_desabilitado" placeholder="Consultar..">
					</div>

				</div>
			</div>
		</div>
		<!-- /.panel -->
	</div>
	<!-- /.row -->
</div>
		</div>
	</div>

	<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-dialog">
			<!--  style="width: 90%"> -->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
					<h4 id="myModalLabel">Novo Documento</h4>
				</div>
				<div class="modal-body" style="padding: 15px;">
					<form action="" method="post">
					{% csrf_token %}
						<div class="row" style="	padding-left: 15px; padding-right: 15px">
							<div style='padding-left: 8px'>
								<sub>{{ formulario.documento.label }}</sub>
							</div>
							{{ formulario.documento }}
						</div>
						<div class="row" style="padding-left: 15px; padding-right: 15px">
							<div style='padding-left: 8px'>
								<sub>{{ formulario.descricao.label }}</sub>
							</div>
							{{ formulario.descricao }}
						</div>

						<div class="row">
							<div class="col-lg-3 col-lg-push-9">
								<button type="submit" id="bt_submit_documento" class="btn btn-primary form-control" style="position: relative; margin-top: 20px"></button>
								<!-- <a href="#myModal" role="button" class="btn btn-primary form-control" data-toggle="modal" '  > Adicionar</a>  -->
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block recursos_complementares %}
{% load staticfiles %}
{% load compress %}
{% compress js %}
<script src="{% static 'custom/datatable/DataTables-1.10.11/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'custom/datatable/DataTables-1.10.11/js/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'custom/datatable/plugins/select/Select-1.1.2/js/dataTables.select.min.js' %}"></script>
<script src="{% static 'modules/core/mask.js' %}"></script>
<script src="{% static 'modules/core/controle_botoes.js' %}"></script>
<script src="{% static 'modules/protocol/protocolo.js' %}"></script>
<script src="{% static 'modules/protocol/protocolController.js' %}"></script>
{% endcompress %}
{% include "componentes/mensagem.html" with messages=messages %}

<script>
	$('#datatable').DataTable({
		"pagingType": "simple_numbers",
		"lengthMenu": [[10, 100, -1], [10, 100, "All"]],
		"dom": '<"top">rt"<"rightcolumn"><"clear">p',
		"bSort": true,
		"ordering": true,
		"bAutoWidth": false,
		"aoColumns": [
	                  { "sWidth": "20px" }, // 1st column width
	                  { "sWidth": null }, // 2th column width
                              { "sWidth": null }, // 3st column width
	            ],

                //"columnDefs": [ {
		      //"targets": 0,
		      ///"data": null,
		      //"orderable": false,
		      //"className": 'details-control',
		      //"defaultContent": '<button><i class="fa fa-plus" aria-hidden="true"></i> oi</button>'
		    //} ]


	});

	var table = $('#datatable').DataTable();
	$('#datatable'+' tbody').on('click', 'tr', function () {

	     if ($(this).hasClass('selected') ) {
	       $(this).removeClass('selected');
			 //alert("desmarquei");
	       desabilitar_botao('#bt_excluir');
			 desabilitar_botao('#bt_alterar');
	       $('#bt_excluir').addClass('link_desabilitado');
			 $('#bt_alterar').addClass('link_desabilitado');
	     }
	     else {
			 //alert("marquei");
	       table.$('tr.selected').removeClass('selected');
	       $(this).addClass('selected');
	       habilitar_botao('#bt_excluir');
			 habilitar_botao('#bt_alterar');
			 $('#bt_excluir').removeClass('link_desabilitado');
			 $('#bt_alterar').removeClass('link_desabilitado');

	      //alert("Quero procurar os detalhes de: "+table.cell('.selected', 0).data());
	      /*
	      $.ajax({
				url: 'get_detalhes_protocolo/'+table.cell('.selected', 0).data(),
				type: 'get', //this is the default though, you don't actually need to always mention it
				success: function(data) {
					///alert(data['data']);

					$('#lb_emitido_por').text(data['emitido_por']);
					var table_detalhes = $('#datatable_detalhes').DataTable();
					table_detalhes.rows().remove();
					table_detalhes.rows.add(data['data']).draw();


					$("#datatable_detalhes tbody tr td").addClass("center_align");
					$("#datatable_detalhes tbody tr td:first-child").removeClass("centralizado").addClass("left_align");


					//alert("consegui?");

				},
				failure: function(data) {
					alert('Got an error dude');
				}
			});
			*/

	     }

	});

	$('#bt_excluir').click( function () {
		if (confirm('Deseja mesmo excluir esse documento?')) {
			//alert('/protocolo/documento/excluir/' + table.cell('.selected', 0).data())
			$.ajax({
				url: '/protocolo/documento/excluir/' + table.cell('.selected', 0).data(),
				type: 'get', //this is the default though, you don't actually need to always mention it
				success: function (data) {
				table.
					row('.selected').remove().draw(false );
				$('#bt_excluir').addClass('link_desabilitado');
				$('#bt_alterar').addClass('link_desabilitado');
			},
			failure: function(data) {
				alert('Erro! Falha na exclusão do registro');
			}
		});
		 }
	});

	$('#datatable tbody').on( 'click', 'button', function () {
	    var data = table.row( $(this).parents('tr') ).data();
	    alert( data[0] +"'s salary is: "+ data[ 5 ] );
	} );
</script>

<script type="text/javascript">
$('#bt_adicionar').click( function () {
    $("#bt_submit_documento").attr('name','adicionar_documento');
    $("#bt_submit_documento").text('Adicionar');
    //alert("Quero adicionar");
});

$('#bt_alterar').click( function () {
    $("#bt_submit_documento").attr('name','alterar_documento');
    $("#bt_submit_documento").attr('value',table.cell('.selected', 0).data());
    $("#bt_submit_documento").text('Alterar');

    $.ajax({
        url: '/protocolo/documento/'+table.cell('.selected', 0).data(),
        type: 'get', //this is the default though, you don't actually need to always mention it
        success: function(data) {
            $('#documento').val(data[0]);
            $('#descricao').val(data[1]);

        },
        failure: function(data) {
            alert('Erro! Falha na exclusão do registro');
        }
    });

    $("#bt_submit_documento").click(function () {
        if (window.confirm('Deseja mesmo alterar esse documento?')){
            return true;
        }
        else{
            return false;
        }
    });

});

//
</script>

<script>
$('#search').on( 'keyup', function () {
  var table = $('#datatable').DataTable();
  var campo = $('#buscar_por').val();
  table.search('').columns().search( '' ).draw(); // reseta a pesquisa
  table.columns(campo).search($('#search').val()).draw();
  //table.search( this.value ).search(this.value).draw(); // Busca em todas as colunas
});

$('#buscar_por').change(function() {
	var table = $('#datatable').DataTable();
	var campo = $('#buscar_por').val();
	table.search('').columns().search( '' ).draw(); // reseta a pesquisa
	table.columns(campo).search($('#search').val()).draw();
});

{% if dados %}
  $('#buscar_por').removeClass('link_desabilitado');
  $('#search').removeClass('link_desabilitado');
  $('#label_buscar_por').removeClass('link_desabilitado');
  document.getElementById("search").focus();

{% else  %}
  $('#buscar_por').addClass('link_desabilitado');
  $('#search').addClass('link_desabilitado');
{% endif %}
</script>

<script>
$('.modal').on('hidden.bs.modal', function(){
	$(this).find('form')[0].reset();
	$("#recebido_por").val('');
	$("#documento").val('');
	$("#observacao_entrega").val('');
    //alert("resetei o form?");
});
</script>

<script>
$(document).ready(function() {
	$('#bt_excluir').addClass('link_desabilitado');
	$('#visualizar_protocolo').addClass('link_desabilitado');
	{% if erro %}
    	$('#myModal').modal('show');
    	BootstrapDialog.show({
	        message: $("Tentando")
	    });

    {% else %}
		$('#myModal').modal('hide');
	{% endif %}
});
</script>
{% endblock %}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
